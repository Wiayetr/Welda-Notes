# 容器镜像管理日志

## 1. ECS开通

1. 在阿里云上进行了一个月的学生认证。
2. 准备继续进行为期6个月的学生认证。

## 2.在ECS安装docker引擎

1. **登录失败**：操作系统禁用密码登录方式

   解决方案：重置密码以后成功登录。

2. 在控制台登录Ubuntu，准备开始安装Docker。

   参考资料为[阿里云ECS服务器安装docker教程（超详细图文教程）_阿里云ecs安装docker-CSDN博客](https://blog.csdn.net/fy512/article/details/122668330)

   **发现问题**：该篇博客使用的是centos登录。

   解决方案：采用其它方法解决，查看docker官方文案.

3. 卸载所有冲突包。

4. Set up docker‘s apt repository

5. install the docker packages （Lastest version）

6. 安装成功。

## 3. 基于ACR配置镜像仓库

1. 阿里云ACR容器镜像首页，创建个人版实例。

2. 设置registry登录密码。密码为myq888oten。

3. 创建命名空间。命名空间：welda。

4. 创建命名仓库。

   - 仓库命名为npu（Nginx-Python-Ubuntu）。

   - 撰写仓库摘要
   - 设置仓库私有而非公开。
   - 选择本地仓库，即通过命令行推送镜像到镜像仓库。后续再选择真实代码源。

## 4. 云服务器新手上路

> 选择完成阿里云云起实验室实验项目：ECS云服务器新手上路。

1. 简单学习了如何创建实例，了解了相关操作。

2. 进行clouder认证课程，需要搭建网站，决定在ubuntu下安装wordpress。

   参考网站：[Ubuntu下安装WordPress教程，超级简单，复制代码就好 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/270230445)

3. 部署失败，显示502错误，说明上游服务器无法访问。

   暂时放弃部署网站

4. 决定完成clouder考试。

5. 完成考试，续领6个月的ECS。

6. 在本地系统基于ssh访问ecs公网地址，首先useradd了wiayetr，表示远程用户。

7. su到root，修改wiayetr密码，与root密码一致。

8. 将wiayetr添加到sudo组，提供sudo权限和docker权限。

## 5. 练习docker常用命令

1.  `docker search nginx`报错

   `permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.44/images/search?term=nginx": dial unix /var/run/docker.sock: connect: permission denied`

   解决方案：

   1. `sudo su`切换为root
   2. `sudo groupadd docker`
   3. `sudo gpasswd -a wiayetr docker`
   4. `newgrp docker`
   5. 切换为wiayetr用户即可解决。

2. `docker run -d --name nginx -p 80:80 nginx`报错

   ```
   8afcfa615f9a417abafd741ac677e2148eb283146bd401f76a4fa292b152c198
   docker: Error response from daemon: driver failed programming external connectivity on endpoint nginx (6a95ef55bc46d9ab4787475d9c4f9c9528b3c5e68f68a98c12b42cad08fae04e): Error starting userland proxy: listen tcp4 0.0.0.0:80: bind: address already in use.
   ```

   原因：之前配置的apache占据了80端口，导致nginx与apache冲突了

   解决方案：

   1. `sudo lsof -i:80`

      找到占据80端口的pid

   2. `sudo kill 【pid】`

      把相关进程全部kill

3. 问题：无法访问网站

   解决方法：网络与安全一栏，选择安全组，点击自己的安全组ID进入安全组详情，并在入方向手动添加安全组，优先级设置为1，端口范围设置为80与443，源设置为0.0.0.0/0。保存即可解决问题。

4. 挂载宿主目录，为nginx服务的配置文件、日志文件以及Web服务的根目录分别建立持久化映射。先在ECS上创建三个宿主目录，然后把nginx容器中的配置文件复制到宿主（否则目录挂载之后，若容器找不到配置文件，服务不能正常运行）。

5. 停止 启动与进出容器

6. 查看容器日志

7. 删除容器镜像

## 6. 构建docker容器镜像

1. 学习到了如何编写dockerfile，实际上就是touch一个文件，再用vim打开编辑即可。后续docker build操作需要用到dockerfile里面的内容。
2. 基于dockerfile创建了包含python基础环境以及nginx服务器的新镜像。

## 7. ACR镜像管理与应用

### 推送容器镜像至ACR

1. 命名空间下的npu镜像仓库，复制仓库地址
2. 使用仓库地址重新标记镜像npu，实验指导中有一个地方有小错误，应该把名为nginx的镜像换成npu。
3. 利用docker push推送镜像至ACR镜像仓库。此后可以在镜像仓库npu的镜像版本页面查看刚刚提交的镜像记录。

### 拉取容器镜像至ECS

1. 删除本地npu库的所有内容
2. 从云端仓库pull下来
3. 完全恢复







